<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebGL</title>
</head>
<body>
<canvas id="canvas" width="800" height="800"></canvas>
Press F12 to show logs
<script type="application/javascript" src="assets/js/framework/InitWebGL.js"></script>
<script type="application/javascript" src="assets/js/framework/Program.js"></script>
<script type="application/javascript" src="assets/js/framework/math/Mat4.js"></script>
<script type="application/javascript" src="assets/js/framework/math/Vec3.js"></script>
<script type="application/javascript" src="assets/js/framework/math/Vec4.js"></script>
<script type="application/javascript" src="assets/js/framework/meshes/Mesh.js"></script>
<script type="application/javascript" src="assets/js/framework/meshes/MeshFactory.js"></script>
<script type="application/javascript" src="assets/js/framework/scene/SceneGraph.js"></script>
<script>
    let gl, p, sg, proj;
    let rot, node;
    window.onload = () => {
        const canvas = document.getElementById('canvas');
        gl = initWebGL(canvas);
        p = new Program(gl, [
            {file: 'VertexShaderSimple.glsl', type: gl.VERTEX_SHADER},
            {file: 'FragmentShaderSimple.glsl', type: gl.FRAGMENT_SHADER},
        ], Program.TYPES.POS_COLOR);

        let m = Mat4.createTranslation(0, 0, 0);
        const axis = new Vec3(1, 1, 0);
        rot = Mat4.createRotation(0.01, axis);
        proj = Mat4.createOrthogonalProjection(-2, 2, -2, 2, 0.1, 50);

        sg = new SceneGraph(p);
        const mesh = new Mesh(gl, p.hProgram, p.type.attr);
        mesh.addAllArrays([
            [-1, -1, 0, 1, 0, 0, 1],
            [1, -1, 0, 1, 0, 0, 1],
            [1, 1, 0, 1, 0, 0, 1],
        ], gl.TRIANGLES);
        node = {mat: m, mesh: mesh, children: []};
        sg.nodes.push(node);

        gl.viewport(0, 0, canvas.width, canvas.height);
        gl.enable(gl.DEPTH_TEST);
        gl.clearColor(0.2, 0.2, 0.2, 1.0);  // background

        render();
    };
    render = () => {
        gl.clear( gl.COLOR_BUFFER_BIT || gl.DEPTH_BUFFER_BIT);
        // node.mat = rot.multiplyMat4(node.mat);

        p.use();
        p.writeMat4('P', proj);
        //scene graph writes the transformation matrix

        sg.render();
        // requestAnimationFrame(render);
    }
</script>
</body>
</html>